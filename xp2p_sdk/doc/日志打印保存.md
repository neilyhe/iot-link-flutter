# 日志系统使用指南

## 概述

本项目提供了一个统一的日志系统，支持不同级别的日志输出、控制台打印和UI显示。日志系统具有以下特点：

- **多级别支持**：DEBUG、INFO、WARN、ERROR四个级别
- **统一格式**：包含时间戳、级别、标签和消息
- **控制台输出**：自动在Flutter调试控制台打印
- **UI集成**：支持在应用界面显示日志
- **级别过滤**：可根据需要设置显示的最低日志级别

## 快速开始

### 1. 导入日志模块

```
import 'package:xp2p_sdk/src/log/logger.dart';
```

### 2. 初始化日志系统（可选）

在应用启动时配置日志系统：

```
void main() {
  // 设置日志级别（默认：DEBUG）
  Logger.setLevel(LogLevel.debug);
  
  // 启用/禁用控制台输出（默认：true）
  Logger.setConsoleOutput(true);
  
  runApp(MyApp());
}
```

### 3. 在StatefulWidget中设置UI回调

```
class MyPage extends StatefulWidget {
  @override
  State<MyPage> createState() => _MyPageState();
}

class _MyPageState extends State<MyPage> {
  String _logOutput = '';

  @override
  void initState() {
    super.initState();
    // 设置UI日志回调
    Logger.setUiLogCallback(_addLog);
  }

  void _addLog(String message) {
    setState(() {
      _logOutput = '$message\n$_logOutput';
    });
  }
}
```

## 日志级别说明

| 级别 | 说明 | 使用场景 |
|------|------|----------|
| DEBUG | 调试信息 | 详细的调试信息，开发阶段使用 |
| INFO | 普通信息 | 常规操作信息，用户可理解的信息 |
| WARN | 警告信息 | 需要注意但不影响正常功能的情况 |
| ERROR | 错误信息 | 错误和异常情况，需要关注的问题 |

## 使用方法

### 基本日志输出

```
// 调试级别日志
Logger.d('这是一条调试信息', 'MyTag');

// 信息级别日志
Logger.i('操作成功完成', 'Service');

// 警告级别日志
Logger.w('内存使用较高，建议优化', 'Performance');

// 错误级别日志
Logger.e('网络连接失败', 'Network');

// 带异常的错误日志
Logger.eWithException('文件读取失败', exception, 'FileIO');
```

### 在XP2P项目中的使用示例

```
// XP2P服务初始化
Logger.i('开始初始化XP2P SDK', 'XP2P');

// 连接状态变化
Logger.i('P2P连接已建立', 'XP2P');
Logger.w('P2P连接断开，尝试重连', 'XP2P');

// 视频流操作
Logger.i('开始接收视频流', 'Video');
Logger.d('收到视频数据包: 1024 bytes', 'Video');
Logger.e('视频解码失败', 'Video');

// 摄像头操作
Logger.i('摄像头初始化完成', 'Camera');
Logger.w('相机权限未授予', 'Camera');

// 信令操作
Logger.i('发送设备状态查询信令', 'Command');
Logger.i('收到设备响应: ${response}', 'Command');
```

### 日志级别过滤

```
// 只显示INFO及以上级别的日志
Logger.setLevel(LogLevel.info);

// 只显示WARN及以上级别的日志
Logger.setLevel(LogLevel.warn);

// 只显示ERROR级别的日志
Logger.setLevel(LogLevel.error);
```

## 最佳实践

### 1. 使用有意义的标签

为不同的功能模块使用不同的标签，便于日志分类和查找：

```
// 好的做法
Logger.i('服务启动成功', 'XP2P');
Logger.i('视频流开始播放', 'Video');
Logger.i('摄像头初始化完成', 'Camera');

// 不好的做法
Logger.i('服务启动成功'); // 缺少标签，难以定位来源
```

### 2. 合理使用日志级别

- **DEBUG**：用于开发调试，生产环境可关闭
- **INFO**：记录重要的操作流程
- **WARN**：记录需要注意但不影响功能的情况
- **ERROR**：记录错误和异常情况

### 3. 包含有用的上下文信息

```
// 好的做法
Logger.i('用户登录成功，用户ID: $userId', 'Auth');
Logger.e('文件上传失败，文件大小: ${file.length} bytes', 'Upload');

// 不好的做法
Logger.i('操作成功'); // 缺少具体信息
```

### 4. 异常处理中的日志使用

```
try {
  await someRiskyOperation();
} catch (e) {
  // 记录详细的错误信息
  Logger.eWithException('操作失败', e, 'Operation');
  
  // 也可以单独记录
  Logger.e('操作失败: $e', 'Operation');
}
```

## 在现有项目中的集成

### 替换原有的print语句

将原有的`print`语句替换为相应的日志级别：

```
// 替换前
print('开始接收视频流...');

// 替换后
Logger.i('开始接收视频流...', 'Video');
```

### 替换debugPrint语句

```
// 替换前
debugPrint('发送摄像头数据失败: $e');

// 替换后
Logger.eWithException('发送摄像头数据失败', e, 'Camera');
```

### 替换自定义的日志方法

如果项目中有自定义的日志方法，可以统一替换：

```
// 替换前
_addLog('[$timestamp] $message');

// 替换后
Logger.i(message, 'Custom'); // 根据实际情况选择合适的级别和标签
```

## 性能考虑

1. **DEBUG级别日志**：在生产环境中建议关闭，避免性能影响
2. **字符串拼接**：复杂的字符串拼接可以在DEBUG级别下使用，避免生产环境开销
3. **频繁日志**：对于高频操作，考虑使用DEBUG级别或减少日志频率

## 调试技巧

### 1. 查看控制台输出

在Flutter开发环境中，日志会自动输出到调试控制台。

### 2. 使用日志级别过滤

在开发阶段使用DEBUG级别，在生产环境使用INFO或WARN级别。

### 3. 使用标签搜索

在IDE的搜索功能中使用标签名快速定位相关日志。